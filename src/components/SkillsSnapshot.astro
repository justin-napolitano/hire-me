---
import type { SkillCluster } from '../config/profile';

const DOT_COUNT = 6;
const levelLabels: Record<number, string> = {
	1: 'Foundational',
	2: 'Associate',
	3: 'Mid-level',
	4: 'Senior',
	5: 'Principal'
};

const clampYearsForDots = (years: number = 0) => {
	const safeYears = Math.round(years);
	return Math.max(0, Math.min(DOT_COUNT, safeYears));
};

const labelForLevel = (level: number) => levelLabels[level] ?? '';

type Props = {
	clusters?: SkillCluster[];
	eyebrow?: string;
	title?: string;
	description?: string;
};

const {
	clusters = [],
	eyebrow = 'Skill coverage',
	title = 'Snapshot of where I specialize',
	description = 'Focus lanes with tactile read on years in the stack rather than blocks of text.'
} = Astro.props as Props;
---
<section class="rounded-3xl border border-[var(--border-strong)] bg-[var(--surface-section)] p-8">
	<header class="mb-6 flex flex-col gap-2">
		{eyebrow && <p class="text-xs uppercase tracking-[0.18em] text-[var(--text-label)]">{eyebrow}</p>}
		{title && <h2 class="text-3xl font-semibold text-[var(--text-primary)]">{title}</h2>}
		{description && <p class="text-sm text-[var(--text-muted)]">{description}</p>}
	</header>
	{clusters.length ? (
		<div class="grid gap-4 md:grid-cols-2">
			{clusters.map((cluster) => {
			const primary = cluster.focus === 'Primary focus';
			const cardClasses = primary
				? 'rounded-2xl border border-[var(--border-strong)] bg-[var(--surface-card)] p-5 shadow-lg'
				: 'rounded-2xl border border-[var(--border-soft)] bg-[var(--surface-card-muted)] p-5 shadow-inner';
			return (
				<article class={cardClasses}>
				<div class="flex flex-col gap-3">
					<div class="flex flex-wrap items-center justify-between gap-2 text-[0.7rem] uppercase tracking-[0.2em] text-[var(--text-label)]">
						<span>{cluster.title}</span>
						<span class="rounded-full border border-[var(--surface-pill-border)] bg-[var(--surface-pill)] px-3 py-1 text-[0.55rem] tracking-[0.25em] text-[var(--text-label)]">
							{cluster.focus}
						</span>
					</div>
					{cluster.headline && (
						<p class="text-sm text-[var(--text-secondary)]">{cluster.headline}</p>
					)}
				</div>
				<ul class="mt-4 flex flex-col gap-3">
					{cluster.skills.map((skill) => {
						const filledDots = clampYearsForDots(skill.years);
						return (
							<li class="rounded-xl border border-[var(--border-soft)] bg-[var(--surface-card-muted)] p-3">
								<div class="flex flex-wrap justify-between gap-3">
									<div class="flex min-w-[160px] flex-col">
										<span class="text-sm font-semibold text-[var(--text-primary)]">{skill.name}</span>
										<span class="text-[0.6rem] uppercase tracking-[0.28em] text-[var(--text-label)]">{labelForLevel(skill.level)}</span>
									</div>
									<div class="flex items-center gap-2" aria-label={`${skill.name} â€” ${skill.years} yrs`} title={`${skill.years} yrs experience`}>
										<div class="flex gap-1">
											{Array.from({ length: DOT_COUNT }).map((_, idx) => (
												<span class={`h-2.5 w-2.5 rounded-full ${idx < filledDots ? 'bg-[var(--accent)]' : 'bg-[var(--border-soft)] opacity-50'}`}></span>
											))}
										</div>
										<span class="text-[0.65rem] text-[var(--text-muted)]">{skill.years}+ yrs</span>
									</div>
								</div>
							</li>
						);
					})}
				</ul>
				</article>
			);
			})}
		</div>
	) : (
		<p class="text-sm text-[var(--text-muted)]">Add at least one skill cluster to render this section.</p>
	)}
</section>
